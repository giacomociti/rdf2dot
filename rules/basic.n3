@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix list: <http://www.w3.org/2000/10/swap/list#> .
@prefix log: <http://www.w3.org/2000/10/swap/log#> .
@prefix v: <http://view/> .

{ 
    ?s ?p ?o .
      # to avoid loops, skip subjects that are nodes or links
    ( ?x { ?s a v:Link } () ) log:collectAllIn [] .
    ( ?x { ?s a v:Node } () ) log:collectAllIn [] .
    ?s log:skolem ?source .
    ?o log:skolem ?target .
    ?p log:localName ?label ; log:uri ?tooltip
}
=>
{
    ?source a v:Node ; v:term ?s .
    ?target a v:Node ; v:term ?o .
    [] a v:Link ;
        v:label ?label ;
        v:tooltip ?tooltip ;
        v:term ?p ;
        v:source ?source ;
        v:target ?target ;
}
.


{  
    ?n a v:Node ; v:term ?uri .
    ?uri log:rawType log:Other .
    ?uri log:uri ?tooltip ;
         log:localName ?label .
}
=> 
{
    ?n v:label ?label ;
        v:tooltip ?tooltip .
} .

{  
    ?n a v:Node ; v:term ?literal .
    ?literal log:rawType log:Literal .
    (?label ?type) log:dtlit ?literal .
    ?type log:notEqualTo rdf:langString .
    ?type log:uri ?dataType
}
=> 
{
    ?n v:label ?label ;
        v:shape "rectangle" ;
        v:tooltip ?dataType .
} .

{  
    ?n a v:Node ; v:term ?literal .
    ?literal log:rawType log:Literal .
    (?label rdf:langString) log:dtlit ?literal .
    (?text ?lang) log:langlit ?literal
}
=> 
{
    ?n v:label ?text ;
        v:shape "rectangle" ;
        v:tooltip ?lang .
} .


{
    ?blankType list:in (log:LabeledBlankNode log:UnlabeledBlankNode) .
    ?n a v:Node ; v:term ?blank .
    ?blank log:rawType ?blankType 
}
=> 
{
    ?n v:label "" ;
       v:shape "circle"
} .
